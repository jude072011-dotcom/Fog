<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-44TM52GM2B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-44TM52GM2B');
    </script>
    <!-- Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start': new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PP6772XP');
    </script>
    <!-- End Google Tag Manager -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3724985851304355"
            crossorigin="anonymous"></script>
    <title>Fog</title>
    <link rel="stylesheet" href="./styles/style.css">
    <link href="../nav.css" rel="stylesheet">
    <link rel="stylesheet" href="./nav.css">
    <link rel="stylesheet" id="themeStylesheetlink">
    <script src="particles.js"></script>
    <script href="./index.js"></script>

    <title>Fog Menu</title>
    <script>
        document.onkeydown = function (e) {
            if (event.keyCode == 123) {
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {
                return false;
            }
            if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) {
                return false;
            }
            if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) {
                return false;
            }
        }
    </script>
</head>
<style>
    h1 {
        margin: 0 0 0 0;
    }

    body {
        overflow-y: scroll;
        height: 30in;
        background-image: url(./imgs/Karda\ Home@2x.png);
    }

    #myDiv {
        display: none;
        z-index: 99999999999999999;
    }

    #adminButton {
        display: none;
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 10px;
        background-color: #4d4c4c;
        color: #fff;
        cursor: pointer;
        border: none;
        border-radius: 5px;
    }

    #passwordFormContainer {
        background-color: #1a1a1a;
        padding: 20px;
        border-radius: 5px;
        align-items: center;
    }

        #passwordFormContainer label {
            display: block;
            margin-bottom: 10px;
        }

        #passwordFormContainer input[type="password"] {
            padding: 8px;
            border-radius: 3px;
            border: 1px solid #ccc;
            width: 100%;
        }

        #passwordFormContainer button {
            padding: 10px 20px;
            background-color: #000000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
</style>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PP6772XP"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
    <nav class="ka-boom">
        <ul class="nav">
            <li><a href="./index.html">Home</a></li>
            <li><a href="./select/">Search</a></li>
            <li><a href="./games">Menu</a></li>
            <li><a href="./media/">Media</a></li>
            <li><a href="./settings2.html">Settings</a></li>
        </ul>
    </nav>

    <iframe src="./scripts/clouds.html" style="position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:-1;"></iframe>
    <button id="adminButton" onclick="window.location.href='./admin'">🛠️ Admin Panel</button>

    <div>
        <h1 style="
            @font-face {
                font-family: A;
                src: url(../AE.otf);
            }
            font-family: A;
            opacity: 0;
            animation-name: drop-fade;
            animation-duration: 0s;
            text-align:center;
            font-size: 100px;
            animation-delay: 0s;
            animation-fill-mode: forwards;">
            Settings
        </h1>
    </div>

    <script>
        var site = getCurrentURL();
        var name = new URL(site).host;
        var url = 'bg' + '.' + name;

        //Other Stuff
        console.log(url);

        function getCurrentURL() {
            return window.location.href;
        }
    </script>

    <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
    <section>
        <div class="group">
            <h2 style="transform: translateY(-145px);">Game Settings</h2>
            <div id="Games">
                <p>soon...</p>
                <br>
                <br>
                <br>
                <h2>Miscellaneous</h2>
                <label for="toggleButton">Performance Mode</label>
                <input type="checkbox" id="toggleButton" onchange="toggleScriptExecution()">
                <br>
                <br>
                <br>

                <h2>Account Actions</h2>
                <div id="accountDetails"></div>
                <button id="signOutButton">Sign Out</button>
                <br>
                <br>
                <br>
            </div>
        </div>

        <div style="position: absolute; left: 50%; transform: translate(-50%, 125%); text-align: center; color: white; z-index: 999;">
            <p style="font-size: 24px;">Credits</p>
            <p style="font-size: 20px;">Developers & Contributors</p>
            <p>Rive, Zenfy, BlazerHM</p>
            <hr style="width: 80%; margin: auto; margin-top: 20px; margin-bottom: 10px; border-color: white;">
            <p style="font-size: 20px;">Game Sources</p>
            <p>Unblockedgames76, Unblockedgames77, 3kh0, MathPlayground 😭</p>
        </div>

        <script src="./scripts/fullscreen.js"></script>
        <script src="./scripts/show.js"></script>

        <script>
            function toggleScriptExecution() {
                const isChecked = document.getElementById('toggleButton').checked;
                if (isChecked) {
                    window.addEventListener('load', executeScript);
                } else {
                    window.removeEventListener('load', executeScript);
                    document.cookie = "scriptEnabled=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                }
                document.cookie = "scriptEnabled=" + isChecked;
            }

            function executeScript() {
                const iframes = document.querySelectorAll('iframe[src="./scripts/clouds.html"]');
                iframes.forEach(iframe => {
                    iframe.remove();
                });
            }

            window.addEventListener('load', function () {
                const cookies = document.cookie.split(';').map(cookie => cookie.trim());
                const scriptEnabledCookie = cookies.find(cookie => cookie.startsWith('scriptEnabled='));
                if (scriptEnabledCookie) {
                    const scriptEnabledValue = scriptEnabledCookie.split('=')[1];
                    const scriptEnabled = scriptEnabledValue === 'true';
                    document.getElementById('toggleButton').checked = scriptEnabled;
                    if (scriptEnabled) {
                        window.addEventListener('load', executeScript);
                    }
                }
            });
        </script>

        <script>
            function removeCloudsIframes() {
                const scriptEnabled = document.cookie.split('; ').find(row => row.startsWith('scriptEnabled='));

                if (scriptEnabled) {
                    const iframes = document.querySelectorAll('iframe[src="./scripts/clouds.html"]');
                    iframes.forEach(iframe => {
                        iframe.remove();
                    });
                } else {
                    const iframeContainer = document.createElement('iframe');
                    iframeContainer.setAttribute('id', 'MyFrame');
                    iframeContainer.setAttribute('src', './scripts/clouds.html');
                    iframeContainer.setAttribute('style', 'position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:-1;');
                    document.body.appendChild(iframeContainer);
                }
            }

            removeCloudsIframes();
        </script>

        <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyAtVsgnaqP6Jl0aqOYwYVMqOE8SS0uHoXA",
                authDomain: "fog-network-accounts.firebaseapp.com",
                projectId: "fog-network-accounts",
                storageBucket: "fog-network-accounts.appspot.com",
                messagingSenderId: "641228125011",
                appId: "1:641228125011:web:607bced8131db7802967a6"
            };

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);

            const database = firebase.database();
            const auth = firebase.auth();

            function getUid() {
                return localStorage.getItem('uid');
            }

            function fetchUserData(uid) {
                return database.ref('users/' + uid).once('value').then(snapshot => snapshot.val());
            }

            function displayAccountDetails(uid, fullName) {
                const accountDetails = document.getElementById('accountDetails');
                accountDetails.innerHTML = `<p>UID: ${uid}</p><p>Username: ${full_name}</p>`;
            }

            function signOut() {
                localStorage.removeItem('uid');
                auth.signOut().then(() => {
                    window.location.href = "./accounts";
                }).catch(error => {
                    console.error('Error signing out:', error);
                });
            }

            document.getElementById('signOutButton').addEventListener('click', signOut);

            function checkAdminStatus(uid) {
                return fetchUserData(uid).then(userData => {
                    if (userData) {
                        if (userData.banned) {
                            auth.signOut().then(() => {
                                window.location.href = "./accounts";
                            });
                            return null;
                        }
                        return userData;
                    } else {
                        throw new Error('User data not found');
                    }
                });
            }

            window.onload = function () {
                const uid = getUid();

                if (uid) {
                    console.log('User is logged in with UID:', uid);
                    checkAdminStatus(uid).then(userData => {
                        if (userData) {
                            displayAccountDetails(uid, userData.fullName);
                            if (userData.admin === true) {
                                document.getElementById('adminButton').style.display = 'block';
                            }
                        }
                    }).catch(error => {
                        console.error('Error fetching user data:', error);
                        window.location.href = "./accounts/#newuser";
                    });
                } else {
                    console.log('No user is logged in.');
                    window.location.href = "./accounts/#newuser";
                }
            };
        </script>
    </section>
</body>
</html>
